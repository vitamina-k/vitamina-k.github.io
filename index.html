<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>VITAMINA K 路 Encuesta y 煤ltimas piezas</title>
<meta name="description" content="Opini贸n, datos y encuestas.">
<meta property="og:title" content="VITAMINA K 路 Encuesta y 煤ltimas piezas">
<meta property="og:description" content="Participa en la encuesta y lee mis 煤ltimas piezas.">
<meta property="og:type" content="website">
<style>
  :root{
    --bg1:#1a1f2b; --bg2:#101522; --glass:rgba(255,255,255,.10);
    --stroke:rgba(255,255,255,.14); --fg:#fff; --muted:#cfd7ffcc;
    --accent:#4ecdc4; --accent2:#7dd3fc; --chip:#ffffff1a;
    --bar:#4ecdc4; --barbg:#ffffff22;
  }
  *{box-sizing:border-box}
  html,body{margin:0;min-height:100%;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--fg);
            font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  a{color:#aee7ff;text-decoration:none} a:hover{text-decoration:underline}
  .wrap{max-width:980px;margin:0 auto;padding:28px}
  .card{background:var(--glass);backdrop-filter:blur(18px) saturate(1.2);border:1px solid var(--stroke);
        border-radius:22px;box-shadow:0 20px 60px #00000055}
  header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:18px 22px}
  .brand{font-weight:900;letter-spacing:.4px}
  .social-mini a{display:inline-block;padding:8px 12px;border:1px solid var(--stroke);border-radius:12px;background:var(--chip);margin-left:8px}
  .hero{padding:30px 26px 24px}
  .hero h1{margin:2px 0 6px;font-size:clamp(22px,4.5vw,34px)}
  .hero p{margin:0;color:var(--muted)}

  /* ENCUESTA */
  .poll{margin-top:18px;display:flex;flex-direction:column;gap:10px}
  .row{display:grid;grid-template-columns:1.1fr 3.2fr 70px;gap:12px;align-items:center;
       padding:10px 12px;border:1px solid #ffffff1f;border-radius:12px;background:#ffffff12;cursor:pointer;
       transition:transform .08s ease, background .2s, border-color .2s}
  .row:hover{transform:translateY(-1px);background:#ffffff22;border-color:#ffffff3a}
  .row.voted{outline:2px solid var(--accent);background:#4ecdc41a}
  .name{font-weight:800}
  .bar{position:relative;height:12px;border-radius:999px;background:var(--barbg);overflow:hidden}
  .fill{position:absolute;left:0;top:0;height:100%;width:0;background:linear-gradient(90deg,var(--bar),var(--accent2));
        transition:width .45s cubic-bezier(.2,.8,.2,1)}
  .pct{text-align:right;font-variant-numeric:tabular-nums;font-weight:800}
  .legend{margin-top:8px;color:var(--muted);font-size:13px}

  /* ltimas piezas */
  .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:22px}
  @media(min-width:760px){ .grid{grid-template-columns:1fr 1fr} }
  .post{padding:18px;border:1px solid var(--stroke);border-radius:16px;background:var(--glass)}
  .post h3{margin:0 0 6px;font-size:18px}
  .post p{margin:0 0 10px;color:var(--muted)}
  .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);background:var(--chip);font-size:12px}

  /* CTA final */
  .cta{margin-top:22px;padding:18px;text-align:center}
  .btn{display:inline-block;margin:6px 8px;padding:10px 14px;border-radius:12px;border:1px solid #ffffff55;background:#ffffff29;color:#fff;text-decoration:none;font-weight:800}
  .btn.primary{background:var(--accent);color:#0b0f1a;border-color:transparent}
  .muted{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <!-- Encabezado -->
  <div class="card">
    <header>
      <div class="brand">VITAMINAK.OF</div>
      <div class="social-mini">
        <a href="https://www.instagram.com/vitaminak.of" target="_blank" rel="noopener">IG</a>
        <a href="https://x.com/vitaminakof" target="_blank" rel="noopener"></a>
      </div>
    </header>
    <!-- Hero -->
    <section class="hero">
      <h1>Encuesta + 煤ltimas piezas</h1>
      <p>Vota y despu茅s l茅ete lo 煤ltimo. Todo claro, corto y con impacto.</p>

      <!-- ===== ENCUESTA de intenci贸n de voto ===== -->
      <div class="poll" id="poll"></div>
      <div class="legend"><span id="legendNote">Porcentaje sobre el total de votos guardados.</span></div>

      <!-- ===== ltimas piezas ===== -->
      <div class="grid" id="ultimas">
        <!-- 1) Granada -->
        <article class="post">
          <h3>Granada: pol茅mica tras retenci贸n de migrantes en la playa</h3>
          <p>Un grupo de ba帽istas retuvo a varios migrantes reci茅n llegados en Castell de Ferro. El episodio encendi贸 el debate social y pol铆tico por el trato a personas que llegan por mar.</p>
          <div class="chips">
            <span class="chip"><a href="https://elpais.com/espana/2025-08-05/un-grupo-de-banistas-retiene-por-la-fuerza-a-migrantes-llegados-a-una-playa-de-granada.html" target="_blank" rel="noopener">Fuente: El Pa铆s</a></span>
            <span class="chip"><a href="https://cadenaser.com/nacional/2025/08/05/pobres-persiguiendo-a-pobres-ismael-serrano-da-en-el-clavo-sobre-la-imagen-mas-triste-del-verano-cadena-ser/" target="_blank" rel="noopener">Cadena SER (reacciones)</a></span>
          </div>
        </article>

        <!-- 2) IRPF/OCDE -->
        <article class="post">
          <h3>IRPF e impuestos al trabajo: la cu帽a fiscal sube al 40,6%</h3>
          <p>La OCDE confirma que, al no actualizar tramos del IRPF con la inflaci贸n, la carga sobre los salarios aument贸 en 2024. En Espa帽a, la cu帽a fiscal (coste total vs. salario neto) alcanz贸 el 40,6%.</p>
          <div class="chips">
            <span class="chip"><a href="https://elpais.com/economia/2025-04-30/la-ocde-constata-los-efectos-de-la-inflacion-en-el-irpf-los-trabajadores-soportan-una-mayor-carga-fiscal-sobre-su-sueldo.html" target="_blank" rel="noopener">Fuente: El Pa铆s / OCDE</a></span>
          </div>
        </article>

        <!-- 3) IPC julio -->
        <article class="post">
          <h3>IPC de julio: 2,7% interanual, la cesta sigue apretando</h3>
          <p>El INE avanz贸 un 2,7% para julio: la inflaci贸n se modera pero la alimentaci贸n contin煤a empujando el coste de vida por encima de lo c贸modo para muchos hogares.</p>
          <div class="chips">
            <span class="chip"><a href="https://theobjective.com/economia/2025-08-13/ine-inflacion-julio-espana-2025/" target="_blank" rel="noopener">Fuente: The Objective / INE</a></span>
          </div>
        </article>
      </div>

      <!-- CTA -->
      <div class="cta">
        <a class="btn" href="https://www.instagram.com/vitaminak.of" target="_blank" rel="noopener"> Instagram</a>
        <a class="btn" href="https://x.com/vitaminakof" target="_blank" rel="noopener"> Seguir</a>
        <a class="btn primary" href="https://www.instagram.com/vitaminak.of" target="_blank" rel="noopener"> No te pierdas lo siguiente</a>
      </div>
    </section>
  </div>
</div>

<script>
/* ====== ENCUESTA con backend Apps Script ======
   Mantengo tu endpoint /exec. Si falla, guarda en localStorage para que no se rompa la UI.
   Estructura de payload:
   { action:"vote", option:"PSOE" }
   Para leer recuento:
   { action:"tally" }  -> { ok:true, votes:{nombre:numero,...}, total:n }
*/
const ENDPOINT = 'https://script.google.com/macros/s/AKfycbxfxtW-bLzKb2uPp9IImq4Ng2LhyzE8MyfQdaBSQAUr5SZmK78bf6jgD0lbwx70FKkv/exec';
const OPTIONS = ['PSOE','Sumar','PP','Vox','Se Acab贸 la Fiesta','Abstenci贸n','Voto nulo','Otros'];
const KEY = 'vk_vote_cache_v2'; // cach茅 local de emergencia

const $poll = document.getElementById('poll');
let state = { votes:Object.fromEntries(OPTIONS.map(n=>[n,0])), total:0, voted:false, choice:'' };

// -------- helpers
const saveLocal=()=>localStorage.setItem(KEY,JSON.stringify(state));
const loadLocal=()=>{ try{ const s=JSON.parse(localStorage.getItem(KEY)||'{}'); if(s && s.votes) state=s; }catch{} };
loadLocal();

function pct(name){ const t = Math.max(1, state.total); return Math.round((state.votes[name]||0)*10000/t)/100; }
function order(){ return [...OPTIONS].sort((a,b)=> (state.votes[b]-state.votes[a]) || a.localeCompare(b)); }

function render(){
  $poll.innerHTML='';
  const t = state.total;
  order().forEach(name=>{
    const row = document.createElement('div'); row.className='row';
    if(state.voted && state.choice===name) row.classList.add('voted');

    const nm = document.createElement('div'); nm.className='name'; nm.textContent = name;
    const bar= document.createElement('div'); bar.className='bar';
    const fill=document.createElement('div'); fill.className='fill';
    const p = t ? pct(name) : 0; requestAnimationFrame(()=>{ fill.style.width = p+'%'; });
    bar.appendChild(fill);

    const pctEl=document.createElement('div'); pctEl.className='pct';
    pctEl.textContent = (t?p.toFixed(1):'0.0')+'%';

    row.append(nm,bar,pctEl);
    row.addEventListener('click',()=> vote(name),{passive:true});
    $poll.appendChild(row);
  });
}

// -------- backend calls
async function fetchTally(){
  try{
    const res = await fetch(ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({action:'tally'})});
    const json = await res.json();
    if(json && json.ok && json.votes){
      state.votes = Object.assign(Object.fromEntries(OPTIONS.map(n=>[n,0])), json.votes);
      state.total = json.total||Object.values(state.votes).reduce((a,b)=>a+b,0);
      render();
      saveLocal();
      return true;
    }
  }catch(e){}
  // fallback local
  render();
  return false;
}

async function vote(option){
  if(state.voted) return;
  try{
    const res = await fetch(ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({action:'vote', option})});
    const json = await res.json();
    if(json && json.ok){
      // servidor devuelve recuento actualizado
      state.votes = Object.assign(Object.fromEntries(OPTIONS.map(n=>[n,0])), json.votes||state.votes);
      state.total = json.total || (state.total+1);
      state.voted = true; state.choice = option;
      saveLocal(); render(); return;
    }
  }catch(e){}
  // fallback local (si server cae)
  state.votes[option] = (state.votes[option]||0)+1;
  state.total += 1; state.voted = true; state.choice = option;
  saveLocal(); render();
}

fetchTally();
render();
</script>
</body>
</html>
